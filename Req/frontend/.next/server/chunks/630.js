exports.id=630,exports.ids=[630],exports.modules={58359:()=>{},93739:()=>{},32916:(e,t,r)=>{"use strict";r.d(t,{Z:()=>G});var s=r(63202),i=r(31324),a=r(31694),n=r(41707),o=r(44125),l=r(52166);function c({children:e,allowedRoles:t,fallbackPath:r,checkPathAccess:c=!0}){let{user:d,isAuthenticated:u,isInitialized:h}=(0,s.t)(),m=(0,i.useRouter)(),f=(0,i.usePathname)(),x=(0,a.useCallback)(e=>r||(0,o.wP)(e),[r]);if((0,a.useCallback)(e=>!t||t.includes(e),[t]),(0,a.useCallback)((e,t)=>!c||(0,o.c1)(e,t),[c]),(0,a.useCallback)(e=>{let t=x(e);m.push(t)},[x,m]),!h)return l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx(n.g,{size:"lg"})});if(u&&d){let r=!t||t.includes(d.role),s=!c||(0,o.c1)(f,d.role);if(r&&s)return l.jsx(l.Fragment,{children:e})}return l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx(n.g,{size:"lg"})})}var d=r(17403),u=r(16546),h=r(8478),m=r(34179),f=r(66352),x=r(83583),p=r(38597);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){y(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function y(e,t,r){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class j{constructor(){y(this,"socket",null),y(this,"isConnected",!1),y(this,"reconnectAttempts",0),y(this,"maxReconnectAttempts",5),y(this,"reconnectDelay",1e3)}async connect(e,t){if(!this.socket?.connected)return this.socket=(0,x.io)("http://localhost:3001",{auth:{token:t},transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:this.reconnectDelay}),this.setupEventHandlers(e),new Promise((t,r)=>{if(!this.socket){r(Error("Socket not initialized"));return}this.socket.on("connect",()=>{console.log("‚úÖ Connected to notification service"),this.isConnected=!0,this.reconnectAttempts=0,this.socket?.emit("join_user_room",e),t()}),this.socket.on("connect_error",e=>{console.error("‚ùå Failed to connect to notification service:",e),this.isConnected=!1,r(e)})})}setupEventHandlers(e){this.socket&&(this.socket.on("notification",e=>{this.handleIncomingNotification(e)}),this.socket.on("notification_read",e=>{console.log("Notification marked as read:",e)}),this.socket.on("system_announcement",e=>{(0,p.ZP)(e,{icon:"\uD83D\uDCE2",duration:6e3,position:"top-center"})}),this.socket.on("reconnect",t=>{console.log(`üîÑ Reconnected to notification service (attempt ${t})`),this.isConnected=!0,this.socket?.emit("join_user_room",e)}),this.socket.on("disconnect",e=>{console.log("\uD83D\uDD0C Disconnected from notification service:",e),this.isConnected=!1}))}handleIncomingNotification(e){let t={duration:this.getToastDuration(e.type),position:"top-right"};switch(e.type){case f.k$.SUCCESS:p.ZP.success(e.message,b(b({},t),{},{icon:"‚úÖ"}));break;case f.k$.ERROR:p.ZP.error(e.message,b(b({},t),{},{icon:"‚ùå"}));break;case f.k$.WARNING:(0,p.ZP)(e.message,b(b({},t),{},{icon:"‚ö†Ô∏è"}));break;case f.k$.INFO:(0,p.ZP)(e.message,b(b({},t),{},{icon:"‚ÑπÔ∏è"}));break;case f.k$.SYSTEM:(0,p.ZP)(e.message,b(b({},t),{},{icon:"\uD83D\uDD27"}));break;case f.k$.REPORT_READY:(0,p.ZP)(e.message,b(b({},t),{},{icon:"\uD83D\uDCCA"}));break;default:(0,p.ZP)(e.message,t)}window.dispatchEvent(new CustomEvent("notification-received",{detail:e}))}getToastDuration(e){switch(e){case f.k$.ERROR:return 8e3;case f.k$.WARNING:return 6e3;case f.k$.SUCCESS:return 4e3;case f.k$.SYSTEM:return 1e4;default:return 5e3}}async getNotifications(e={}){try{let t=new URLSearchParams;e.type&&t.append("type",e.type),void 0!==e.read&&t.append("read",e.read.toString()),e.limit&&t.append("limit",e.limit.toString()),e.offset&&t.append("offset",e.offset.toString());let r=await fetch(`http://localhost:3001/api/notifications?${t.toString()}`,{headers:{Authorization:`Bearer ${this.getToken()}`,"Content-Type":"application/json"}});if(console.log("getNotifications - response status:",r.status),!r.ok)throw Error(`HTTP error! status: ${r.status}`);let s=await r.json();return console.log("getNotifications - response data:",s),s.data||[]}catch(e){throw console.error("Error fetching notifications:",e),e}}async getNotificationStats(){try{let e=await fetch("http://localhost:3001/api/notifications/stats",{headers:{Authorization:`Bearer ${this.getToken()}`,"Content-Type":"application/json"}});if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return(await e.json()).data||{total:0,unread:0,byType:{}}}catch(e){throw console.error("Error fetching notification stats:",e),e}}async markAsRead(e){try{let t=await fetch(`http://localhost:3001/api/notifications/${e}/read`,{method:"PATCH",headers:{Authorization:`Bearer ${this.getToken()}`,"Content-Type":"application/json"}});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);this.socket?.emit("mark_notification_read",e)}catch(e){throw console.error("Error marking notification as read:",e),e}}async markAllAsRead(){try{let e=await fetch("http://localhost:3001/api/notifications/mark-all-read",{method:"PATCH",headers:{Authorization:`Bearer ${this.getToken()}`,"Content-Type":"application/json"}});if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let t=await e.json();return t.data?.markedCount||0}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async deleteNotification(e){try{let t=await fetch(`http://localhost:3001/api/notifications/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${this.getToken()}`,"Content-Type":"application/json"}});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`)}catch(e){throw console.error("Error deleting notification:",e),e}}requestNotifications(e={}){this.socket?.connected&&this.socket.emit("get_notifications",e)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1)}isSocketConnected(){return this.isConnected&&this.socket?.connected===!0}getToken(){let e=localStorage.getItem("auth-storage");if(e)try{let t=JSON.parse(e);return t.state?.token||""}catch(e){console.warn("Error parsing auth storage:",e)}return""}}let v=new j;function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach(function(t){var s,i;s=t,i=r[t],(s=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(s))in e?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let w={total:0,unread:0,byType:{[f.k$.INFO]:0,[f.k$.SUCCESS]:0,[f.k$.WARNING]:0,[f.k$.ERROR]:0,[f.k$.SYSTEM]:0,[f.k$.USER_ACTION]:0,[f.k$.DATA_UPDATE]:0,[f.k$.REPORT_READY]:0}},E=(0,h.Ue)()((0,m.mW)((e,t)=>({notifications:[],stats:w,isLoading:!1,isConnected:!1,error:null,initializeNotifications:async(r,s)=>{e({isLoading:!0,error:null});try{await v.connect(r,s),e({isConnected:!0}),await Promise.all([t().loadNotifications(),t().loadStats()]),window.addEventListener("notification-received",e=>{let r=e.detail;t().addNotification(r),t().loadStats()})}catch(t){console.error("Failed to initialize notifications:",t),e({error:t instanceof Error?t.message:"Failed to initialize notifications",isConnected:!1})}finally{e({isLoading:!1})}},loadNotifications:async(t={})=>{e({isLoading:!0,error:null});try{let r=await v.getNotifications(t);e({notifications:r})}catch(t){console.error("Failed to load notifications:",t),e({error:t instanceof Error?t.message:"Failed to load notifications"})}finally{e({isLoading:!1})}},loadStats:async()=>{try{let t=await v.getNotificationStats();e({stats:t})}catch(e){console.error("Failed to load notification stats:",e)}},markAsRead:async r=>{try{await v.markAsRead(r),e(e=>({notifications:e.notifications.map(e=>e.id===r?k(k({},e),{},{read:!0}):e)})),await t().loadStats()}catch(t){console.error("Failed to mark notification as read:",t),e({error:t instanceof Error?t.message:"Failed to mark notification as read"})}},markAllAsRead:async()=>{try{await v.markAllAsRead()>0&&(e(e=>({notifications:e.notifications.map(e=>k(k({},e),{},{read:!0}))})),await t().loadStats())}catch(t){console.error("Failed to mark all notifications as read:",t),e({error:t instanceof Error?t.message:"Failed to mark all notifications as read"})}},deleteNotification:async r=>{try{await v.deleteNotification(r),e(e=>({notifications:e.notifications.filter(e=>e.id!==r)})),await t().loadStats()}catch(t){console.error("Failed to delete notification:",t),e({error:t instanceof Error?t.message:"Failed to delete notification"})}},addNotification:t=>{e(e=>({notifications:[t,...e.notifications]}))},updateNotification:(t,r)=>{e(e=>({notifications:e.notifications.map(e=>e.id===t?k(k({},e),r):e)}))},clearError:()=>{e({error:null})},disconnect:()=>{v.disconnect(),e({isConnected:!1,notifications:[],stats:w})}}),{name:"notification-store"}));var D=r(27671),A=r(17785);function R({notification:e}){let{markAsRead:t,deleteNotification:r}=E(),{0:s,1:i}=(0,a.useState)(!1),n=async()=>{e.read||await t(e.id)},o=async()=>{i(!0);try{await r(e.id)}catch(e){console.error("Error deleting notification:",e)}finally{i(!1)}},c=e=>{try{return(0,D.Q)(new Date(e),{addSuffix:!0,locale:A.es})}catch(e){return"Fecha inv\xe1lida"}};return l.jsx("div",{className:`p-4 hover:bg-gray-50 transition-colors ${e.read?"":"bg-blue-50 border-l-4 border-blue-400"}`,children:(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[l.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm ${(e=>{switch(e){case f.k$.SUCCESS:return"text-green-600 bg-green-50 border-green-200";case f.k$.ERROR:return"text-red-600 bg-red-50 border-red-200";case f.k$.WARNING:return"text-yellow-600 bg-yellow-50 border-yellow-200";case f.k$.INFO:return"text-blue-600 bg-blue-50 border-blue-200";case f.k$.SYSTEM:return"text-purple-600 bg-purple-50 border-purple-200";case f.k$.USER_ACTION:return"text-indigo-600 bg-indigo-50 border-indigo-200";case f.k$.DATA_UPDATE:return"text-teal-600 bg-teal-50 border-teal-200";case f.k$.REPORT_READY:return"text-orange-600 bg-orange-50 border-orange-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})(e.type)}`,children:(e=>{switch(e){case f.k$.SUCCESS:return"‚úÖ";case f.k$.ERROR:return"‚ùå";case f.k$.WARNING:return"‚ö†Ô∏è";case f.k$.INFO:return"‚ÑπÔ∏è";case f.k$.SYSTEM:return"\uD83D\uDD27";case f.k$.USER_ACTION:return"\uD83D\uDC64";case f.k$.DATA_UPDATE:return"\uD83D\uDCDD";case f.k$.REPORT_READY:return"\uD83D\uDCCA";default:return"\uD83D\uDD14"}})(e.type)}),l.jsx("div",{className:"flex-1 min-w-0",children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[l.jsx("h4",{className:`text-sm font-medium ${e.read?"text-gray-700":"text-gray-900"}`,children:e.title}),l.jsx("p",{className:`mt-1 text-sm ${e.read?"text-gray-600":"text-gray-800"}`,children:e.message}),e.data&&Object.keys(e.data).length>0&&l.jsx("div",{className:"mt-2 p-2 bg-gray-100 rounded text-xs",children:(0,l.jsxs)("details",{children:[l.jsx("summary",{className:"cursor-pointer text-gray-600 hover:text-gray-800",children:"Ver detalles"}),l.jsx("pre",{className:"mt-2 text-gray-700 whitespace-pre-wrap",children:JSON.stringify(e.data,null,2)})]})}),(0,l.jsxs)("div",{className:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[l.jsx("span",{children:c(e.createdAt)}),l.jsx("span",{className:"capitalize",children:e.type}),e.expiresAt&&(0,l.jsxs)("span",{children:["Expira: ",c(e.expiresAt)]})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[!e.read&&(0,l.jsxs)(u.z,{variant:"ghost",size:"sm",onClick:n,className:"text-blue-600 hover:text-blue-800 hover:bg-blue-100",title:"Marcar como le\xedda",children:[l.jsx("span",{className:"sr-only",children:"Marcar como le\xedda"}),"\uD83D\uDC41Ô∏è"]}),(0,l.jsxs)(u.z,{variant:"ghost",size:"sm",onClick:o,disabled:s,className:"text-red-600 hover:text-red-800 hover:bg-red-100",title:"Eliminar notificaci\xf3n",children:[l.jsx("span",{className:"sr-only",children:"Eliminar"}),s?"‚è≥":"\uD83D\uDDD1Ô∏è"]})]})]})})]})})}function C({filter:e,onChange:t}){let r=[{value:"",label:"Todos los tipos"},{value:f.k$.INFO,label:"Informaci\xf3n"},{value:f.k$.SUCCESS,label:"\xc9xito"},{value:f.k$.WARNING,label:"Advertencia"},{value:f.k$.ERROR,label:"Error"},{value:f.k$.SYSTEM,label:"Sistema"},{value:f.k$.USER_ACTION,label:"Acci\xf3n de usuario"},{value:f.k$.DATA_UPDATE,label:"Actualizaci\xf3n de datos"},{value:f.k$.REPORT_READY,label:"Reporte listo"}],s=e=>{t({type:""===e?void 0:e})},i=e=>{t({limit:e})};return(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[l.jsx("label",{htmlFor:"notification-type",className:"text-sm font-medium text-gray-700",children:"Tipo:"}),l.jsx("select",{id:"notification-type",value:e.type||"",onChange:e=>s(e.target.value),className:"text-sm border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:r.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[l.jsx("label",{htmlFor:"notification-limit",className:"text-sm font-medium text-gray-700",children:"Mostrar:"}),(0,l.jsxs)("select",{id:"notification-limit",value:e.limit||20,onChange:e=>i(parseInt(e.target.value,10)),className:"text-sm border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[l.jsx("option",{value:10,children:"10"}),l.jsx("option",{value:20,children:"20"}),l.jsx("option",{value:50,children:"50"}),l.jsx("option",{value:100,children:"100"})]})]}),(e.type||e.limit&&20!==e.limit)&&l.jsx("button",{onClick:()=>t({type:void 0,limit:20}),className:"text-sm text-blue-600 hover:text-blue-800 underline",children:"Limpiar filtros"})]})}function O({stats:e}){let t=e=>{switch(e){case f.k$.INFO:return"Info";case f.k$.SUCCESS:return"\xc9xito";case f.k$.WARNING:return"Advertencia";case f.k$.ERROR:return"Error";case f.k$.SYSTEM:return"Sistema";case f.k$.USER_ACTION:return"Usuario";case f.k$.DATA_UPDATE:return"Datos";case f.k$.REPORT_READY:return"Reportes";default:return e}},r=e=>{switch(e){case f.k$.INFO:return"‚ÑπÔ∏è";case f.k$.SUCCESS:return"‚úÖ";case f.k$.WARNING:return"‚ö†Ô∏è";case f.k$.ERROR:return"‚ùå";case f.k$.SYSTEM:return"\uD83D\uDD27";case f.k$.USER_ACTION:return"\uD83D\uDC64";case f.k$.DATA_UPDATE:return"\uD83D\uDCDD";case f.k$.REPORT_READY:return"\uD83D\uDCCA";default:return"\uD83D\uDD14"}},s=e=>{switch(e){case f.k$.SUCCESS:return"text-green-600 bg-green-100";case f.k$.ERROR:return"text-red-600 bg-red-100";case f.k$.WARNING:return"text-yellow-600 bg-yellow-100";case f.k$.INFO:return"text-blue-600 bg-blue-100";case f.k$.SYSTEM:return"text-purple-600 bg-purple-100";case f.k$.USER_ACTION:return"text-indigo-600 bg-indigo-100";case f.k$.DATA_UPDATE:return"text-teal-600 bg-teal-100";case f.k$.REPORT_READY:return"text-orange-600 bg-orange-100";default:return"text-gray-600 bg-gray-100"}},i=Object.entries(e.byType).filter(([e,t])=>t>0);return(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[l.jsx("span",{className:"font-medium",children:e.total})," total"]}),e.unread>0&&(0,l.jsxs)("div",{className:"text-sm text-red-600",children:[l.jsx("span",{className:"font-medium",children:e.unread})," sin leer"]})]}),e.total>0&&(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[Math.round(e.unread/e.total*100),"% sin leer"]})]}),i.length>0&&l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:i.map(([e,i])=>(0,l.jsxs)("div",{className:`flex items-center space-x-2 px-2 py-1 rounded-md text-xs ${s(e)}`,children:[l.jsx("span",{children:r(e)}),l.jsx("span",{className:"font-medium",children:i}),l.jsx("span",{className:"truncate",children:t(e)})]},e))}),e.total>0&&l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:l.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.max(5,(e.total-e.unread)/e.total*100)}%`}})})]})}var S=r(27667);function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach(function(t){var s,i;s=t,i=r[t],(s=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(s))in e?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function T({isOpen:e,onClose:t}){let{notifications:r,stats:s,isLoading:i,error:o,loadNotifications:c,markAllAsRead:d,clearError:h}=E(),{0:m,1:f}=(0,a.useState)({limit:20,offset:0}),{0:x,1:p}=(0,a.useState)("all"),g=e=>{p(e),f(e=>P(P({},e),{},{offset:0}))},b=async()=>{await d(),c(P(P({},m),{},{read:"unread"!==x&&void 0}))};return e?l.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,l.jsxs)(S.Zb,{className:"w-full max-w-2xl max-h-[80vh] bg-white rounded-lg shadow-xl",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[l.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Centro de Notificaciones"}),s.unread>0&&l.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:s.unread})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[s.unread>0&&l.jsx(u.z,{variant:"outline",size:"sm",onClick:b,disabled:i,children:"Marcar todas como le\xeddas"}),l.jsx(u.z,{variant:"ghost",size:"sm",onClick:t,className:"text-gray-500 hover:text-gray-700",children:"‚úï"})]})]}),l.jsx("div",{className:"p-4 border-b bg-gray-50",children:l.jsx(O,{stats:s})}),(0,l.jsxs)("div",{className:"flex border-b",children:[(0,l.jsxs)("button",{className:`flex-1 py-3 px-4 text-sm font-medium ${"all"===x?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>g("all"),children:["Todas (",s.total,")"]}),(0,l.jsxs)("button",{className:`flex-1 py-3 px-4 text-sm font-medium ${"unread"===x?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>g("unread"),children:["No le\xeddas (",s.unread,")"]})]}),l.jsx("div",{className:"p-4 border-b",children:l.jsx(C,{filter:m,onChange:e=>{f(t=>P(P(P({},t),e),{},{offset:0}))}})}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto max-h-96",children:[o&&l.jsx("div",{className:"p-4 bg-red-50 border-l-4 border-red-400",children:(0,l.jsxs)("div",{className:"flex",children:[l.jsx("div",{className:"flex-shrink-0",children:l.jsx("span",{className:"text-red-400",children:"‚ö†Ô∏è"})}),(0,l.jsxs)("div",{className:"ml-3",children:[l.jsx("p",{className:"text-sm text-red-700",children:o}),l.jsx(u.z,{variant:"ghost",size:"sm",onClick:h,className:"mt-2 text-red-600 hover:text-red-800",children:"Cerrar"})]})]})}),i&&0===r.length?l.jsx("div",{className:"flex items-center justify-center p-8",children:l.jsx(n.g,{})}):0===r.length?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 text-gray-500",children:[l.jsx("div",{className:"text-4xl mb-4",children:"\uD83D\uDD14"}),l.jsx("p",{className:"text-lg font-medium",children:"No hay notificaciones"}),l.jsx("p",{className:"text-sm",children:"unread"===x?"No tienes notificaciones sin leer":"No tienes notificaciones"})]}):l.jsx("div",{className:"divide-y divide-gray-200",children:r.map(e=>l.jsx(R,{notification:e},e.id))}),r.length>0&&r.length>=(m.limit||20)&&l.jsx("div",{className:"p-4 text-center border-t",children:l.jsx(u.z,{variant:"outline",onClick:()=>{f(e=>P(P({},e),{},{offset:(e.offset||0)+(e.limit||20)}))},disabled:i,children:i?"Cargando...":"Cargar m\xe1s"})})]})]})}):null}function I(){let{0:e,1:t}=(0,a.useState)(!1),{unreadCount:r,isConnected:i}=function(){let{user:e,token:t,isAuthenticated:r}=(0,s.t)(),{notifications:i,stats:n,isLoading:o,isConnected:l,error:c,initializeNotifications:d,disconnect:u,clearError:h}=E();return{notifications:i,stats:n,isLoading:o,isConnected:l,error:c,clearError:(0,a.useCallback)(()=>{h()},[h]),hasUnreadNotifications:n.unread>0,unreadCount:n.unread}}();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(u.z,{variant:"ghost",size:"sm",onClick:()=>{t(!e)},className:"relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100",title:"Notificaciones",children:[l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),r>0&&l.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium",children:r>99?"99+":r}),l.jsx("span",{className:`absolute bottom-0 right-0 w-2 h-2 rounded-full ${i?"bg-green-400":"bg-gray-400"}`,title:i?"Conectado":"Desconectado"})]}),l.jsx(T,{isOpen:e,onClose:()=>{t(!1)}})]})}var M=r(69805);function U({className:e,user:t,onLogout:r,onMenuClick:s}){let{0:i,1:n}=(0,a.useState)(!1),o=(0,a.useRef)(null),c=(0,a.useRef)(null);return(0,l.jsxs)("header",{className:(0,d.cn)("bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between",e),children:[l.jsx("div",{className:"flex items-center md:hidden",children:l.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 p-2 rounded-md",onClick:s,"aria-label":"Open menu",children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})}),l.jsx("div",{className:"flex-1 flex justify-end",children:(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[l.jsx(I,{}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{ref:c,type:"button",className:"flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full p-1",onClick:()=>n(!i),"aria-expanded":i,"aria-haspopup":"true",children:[l.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center text-gray-600",children:t?t.firstName.charAt(0)+t.lastName.charAt(0):"U"}),l.jsx("span",{className:"hidden md:block text-sm font-medium text-gray-700",children:t?`${t.firstName} ${t.lastName}`:"Usuario"}),l.jsx("svg",{className:"hidden md:block h-4 w-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:l.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),i&&l.jsx("div",{ref:o,className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 border border-gray-200",role:"menu","aria-orientation":"vertical","aria-labelledby":"user-menu",children:t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"px-4 py-2 text-sm text-gray-700 border-b border-gray-200",children:[l.jsx("p",{className:"font-medium",children:`${t.firstName} ${t.lastName}`}),l.jsx("p",{className:"text-gray-500",children:t.email}),(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Rol: ",t.role]})]}),l.jsx(M.default,{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>n(!1),role:"menuitem",children:"Mi perfil"}),l.jsx(M.default,{href:"/settings",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>n(!1),role:"menuitem",children:"Configuraci\xf3n"}),l.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>{n(!1),r?.()},role:"menuitem",children:"Cerrar sesi\xf3n"})]}):l.jsx(l.Fragment,{children:l.jsx(M.default,{href:"/login",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>n(!1),role:"menuitem",children:"Iniciar sesi\xf3n"})})})]})]})})]})}function _({className:e,userRole:t}){let r=(0,i.usePathname)(),s=(0,o.EH)(o.Hc,t);return(0,l.jsxs)("div",{className:(0,d.cn)("flex flex-col h-full bg-gray-900 text-white w-64",e),children:[l.jsx("div",{className:"p-4",children:l.jsx("h1",{className:"text-xl font-bold",children:"Sistema de Gesti\xf3n"})}),l.jsx("nav",{className:"flex-1 px-2 py-4 space-y-1 overflow-y-auto",children:s.map(e=>l.jsx(z,{item:e,pathname:r},e.href))}),l.jsx("div",{className:"p-4 border-t border-gray-800",children:l.jsx("p",{className:"text-sm text-gray-400",children:"\xa9 2025 Sistema de Gesti\xf3n"})})]})}function z({item:e,pathname:t}){let r=t===e.href,s=t.startsWith(`${e.href}/`),i=e.children&&e.children.length>0,{0:n,1:o}=(0,a.useState)(r||s);return(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)(M.default,{href:e.href,className:(0,d.cn)("flex flex-1 items-center px-4 py-2 text-sm font-medium rounded-md transition-colors",r||s?"bg-gray-800 text-white":"text-gray-300 hover:bg-gray-700 hover:text-white"),children:[e.icon&&l.jsx(F,{name:e.icon,className:"mr-3 h-5 w-5"}),l.jsx("span",{className:"flex-1",children:e.name})]}),i&&l.jsx("button",{onClick:()=>o(!n),className:"p-2 rounded-md text-gray-400 hover:bg-gray-700 hover:text-white focus:outline-none","aria-label":n?"Collapse":"Expand",children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:(0,d.cn)("h-4 w-4 transition-transform",n?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),i&&n&&l.jsx("div",{className:"ml-6 space-y-1 border-l border-gray-700 pl-2",children:e.children.map(e=>l.jsx(M.default,{href:e.href,className:(0,d.cn)("flex items-center px-4 py-2 text-sm font-medium rounded-md transition-colors",t===e.href?"bg-gray-800 text-white":"text-gray-400 hover:bg-gray-700 hover:text-white"),title:e.description,children:e.name},e.href))})]})}function F({name:e,className:t}){return({dashboard:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[l.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),l.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),l.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),l.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]}),database:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[l.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),l.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),l.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),chart:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[l.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),l.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),l.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),settings:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[l.jsx("circle",{cx:"12",cy:"12",r:"3"}),l.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})[e]||null}function L({children:e,user:t,onLogout:r}){return(0,l.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[l.jsx(_,{userRole:t?.role,className:"hidden md:block"}),(0,l.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[l.jsx(U,{user:t,onLogout:r}),l.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:e})]})]})}function G({children:e,allowedRoles:t,title:r,requireAuth:a=!0,checkPathAccess:n=!0}){let{user:d,logout:u}=(0,s.t)(),h=(0,i.useRouter)();return a?l.jsx(c,{allowedRoles:t,fallbackPath:d?(0,o.wP)(d.role):"/login",checkPathAccess:n,children:(0,l.jsxs)(L,{user:d,onLogout:()=>{u(),h.push("/login")},children:[r&&l.jsx("div",{className:"mb-6",children:l.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:r})}),e]})}):l.jsx(l.Fragment,{children:e})}},41707:(e,t,r)=>{"use strict";r.d(t,{g:()=>a});var s=r(17403),i=r(52166);function a({size:e="md",className:t}){return i.jsx("div",{className:"flex justify-center items-center",children:i.jsx("div",{className:(0,s.cn)("animate-spin rounded-full border-t-transparent border-blue-600",{sm:"h-4 w-4 border-2",md:"h-6 w-6 border-2",lg:"h-8 w-8 border-3"}[e],t)})})}},44125:(e,t,r)=>{"use strict";r.d(t,{EH:()=>o,Hc:()=>n,c1:()=>l,wP:()=>c});var s=r(66352);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){var s,i;s=t,i=r[t],(s=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(s))in e?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let n=[{name:"Dashboard",href:"/dashboard",icon:"dashboard",description:"Vista general del sistema"},{name:"Registros",href:"/records",icon:"database",description:"Gesti\xf3n de datos y registros",roles:[s.i4.ADMIN,s.i4.MANAGER,s.i4.USER],children:[{name:"Todos los registros",href:"/records",description:"Ver todos los registros"},{name:"Crear registro",href:"/records/new",description:"Crear un nuevo registro",roles:[s.i4.ADMIN,s.i4.MANAGER,s.i4.USER]},{name:"B\xfasqueda avanzada",href:"/records/search",description:"B\xfasqueda avanzada de registros"}]},{name:"Reportes",href:"/reports",icon:"chart",description:"Generaci\xf3n y visualizaci\xf3n de reportes",roles:[s.i4.ADMIN,s.i4.MANAGER],children:[{name:"Reportes disponibles",href:"/reports",description:"Ver reportes disponibles"},{name:"Crear reporte",href:"/reports/create",description:"Crear un nuevo reporte",roles:[s.i4.ADMIN,s.i4.MANAGER]},{name:"Reportes programados",href:"/reports/scheduled",description:"Ver reportes programados",roles:[s.i4.ADMIN,s.i4.MANAGER]}]},{name:"Administraci\xf3n",href:"/admin",icon:"settings",description:"Configuraci\xf3n y administraci\xf3n del sistema",roles:[s.i4.ADMIN],children:[{name:"Usuarios",href:"/admin/users",description:"Gesti\xf3n de usuarios"},{name:"Configuraci\xf3n",href:"/admin/settings",description:"Configuraci\xf3n del sistema"},{name:"Auditor\xeda",href:"/admin/audit",description:"Logs de auditor\xeda"}]}];function o(e,t){return t?e.filter(e=>!e.roles||e.roles.includes(t)).map(e=>e.children?a(a({},e),{},{children:e.children.filter(e=>!e.roles||e.roles.includes(t))}):e):e.filter(e=>!e.roles)}function l(e,t){if(!t)return!1;if(t===s.i4.ADMIN)return!0;let r="/"+e.split("/")[1];if(!(({[s.i4.ADMIN]:["/admin","/reports","/records","/dashboard"],[s.i4.MANAGER]:["/reports","/records","/dashboard"],[s.i4.USER]:["/records","/dashboard"],[s.i4.VIEWER]:["/dashboard"]})[t]||[]).includes(r))return!1;if(e!==r){let s=e.split("/").slice(0,3).join("/"),i=n.find(e=>e.href===r),a=i?.children?.find(e=>e.href===s);if(a&&a.roles&&!a.roles.includes(t))return!1}return!0}function c(e){return e?({[s.i4.ADMIN]:"/dashboard",[s.i4.MANAGER]:"/dashboard",[s.i4.USER]:"/dashboard",[s.i4.VIEWER]:"/dashboard"})[e]||"/dashboard":"/login"}},66352:(e,t,r)=>{"use strict";r.d(t,{i4:()=>s,k$:()=>i});let s=function(e){return e.ADMIN="ADMIN",e.MANAGER="MANAGER",e.USER="USER",e.VIEWER="VIEWER",e}({}),i=function(e){return e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error",e.SYSTEM="system",e.USER_ACTION="user_action",e.DATA_UPDATE="data_update",e.REPORT_READY="report_ready",e}({})}};