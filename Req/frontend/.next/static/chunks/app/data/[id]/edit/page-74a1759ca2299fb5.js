(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[151],{69114:function(e,r,t){Promise.resolve().then(t.bind(t,63931))},63931:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return y}});var n=t(50090),s=t(30837),o=t.n(s),a=t(10138),i=t(93033),c=t(83740),l=t(19163),u=t(83915),d=t(17099),f=t(36118),h=t(57437);function p(e){var r=e.record,t=e.conflictingRecord,n=e.history,s=e.showConflictResolution,o=e.showVersionHistory,p=e.isLoading,x=e.isLoadingRecord,v=e.isLoadingHistory,g=e.error,y=e.onSave,m=e.onCancel,b=e.onConflictResolve,w=e.onConflictCancel,R=e.onRestoreVersion,C=e.onShowHistory,k=e.onCloseHistory;return x?(0,h.jsx)(l.p,{}):g&&!r?(0,h.jsx)(u.d,{error:g}):s&&r&&t?(0,h.jsx)("div",{className:"container mx-auto py-6",children:(0,h.jsx)(i.W,{currentRecord:r,conflictingRecord:t,onResolve:b,onCancel:w})}):o&&r?(0,h.jsx)("div",{className:"container mx-auto py-6",children:(0,h.jsx)(c.B,{history:n,onRestore:R,onClose:k,isLoading:v})}):(0,h.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,h.jsx)(d.b,{record:r,onShowHistory:C,isLoadingHistory:v}),g&&(0,h.jsx)(f.Zb,{children:(0,h.jsx)(f.aY,{className:"pt-6",children:(0,h.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:g})})}),r&&(0,h.jsx)(a.v,{record:r,onSave:y,onCancel:m,isLoading:p})]})}var x=t(2265),v=t(32921),g=t(43998);function y(e){var r,t,s,a,i,c,l,u,d,f,y,m,b,w,R,C,k,j,E,H,S,L,N,V,Z,I,F,_,z,O,B,T,D,W,Y,q,A,M,P,Q,G,J,K,U,X,$,ee,er,et=e.params,en=(r=et.id,t=(0,v.useRouter)(),a=(s=(0,x.useState)(null))[0],i=s[1],l=(c=(0,x.useState)(null))[0],u=c[1],f=(d=(0,x.useState)([]))[0],y=d[1],b=(m=(0,x.useState)(!1))[0],w=m[1],C=(R=(0,x.useState)(!1))[0],k=R[1],E=(j=(0,x.useState)(!1))[0],H=j[1],L=(S=(0,x.useState)(!0))[0],N=S[1],Z=(V=(0,x.useState)(!1))[0],I=V[1],_=(F=(0,x.useState)(null))[0],z=F[1],B=(O=(0,x.useState)(1))[0],T=O[1],(0,x.useEffect)(function(){var e,t=(e=(0,n.Z)(o().mark(function e(){var t,n,s;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,N(!0),z(null),e.next=5,g.c.getRecord(r);case 5:(t=e.sent).success&&t.data?(i(t.data),T((null===(n=t.data.metadata)||void 0===n?void 0:n.version)||1)):z((null===(s=t.error)||void 0===s?void 0:s.message)||"Error al cargar el registro"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),z("Error de conexi\xf3n al cargar el registro"),e.t0 instanceof Error&&z("Error de conexi\xf3n: ".concat(e.t0.message));case 13:return e.prev=13,N(!1),e.finish(13);case 16:case"end":return e.stop()}},e,null,[[0,9,13,16]])})),function(){return e.apply(this,arguments)});r&&t()},[r]),D=(0,n.Z)(o().mark(function e(){var t,n;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.c.checkForConflicts(r,B);case 3:if(!((n=e.sent).success&&null!==(t=n.data)&&void 0!==t&&t.hasConflict&&n.data.currentRecord)){e.next=8;break}return u(n.data.currentRecord),w(!0),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 11:return e.prev=11,e.t0=e.catch(0),e.t0 instanceof Error&&z("Error checking conflicts: ".concat(e.t0.message)),e.abrupt("return",!1);case 15:case"end":return e.stop()}},e,null,[[0,11]])})),W=function(){return D.apply(this,arguments)},Y=(0,n.Z)(o().mark(function e(){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I(!0),e.next=4,g.c.getRecordHistory(r);case 4:(t=e.sent).success&&t.data&&y(t.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0 instanceof Error&&z("Error loading history: ".concat(e.t0.message));case 11:return e.prev=11,I(!1),e.finish(11);case 14:case"end":return e.stop()}},e,null,[[0,8,11,14]])})),{record:a,conflictingRecord:l,history:f,showConflictResolution:b,showVersionHistory:C,isLoading:E,isLoadingRecord:L,isLoadingHistory:Z,error:_,originalVersion:B,setRecord:i,setConflictingRecord:u,setShowConflictResolution:w,setShowVersionHistory:k,setIsLoading:H,setError:z,checkForConflicts:W,loadHistory:function(){return Y.apply(this,arguments)},router:t}),es=en.record,eo=en.conflictingRecord,ea=en.history,ei=en.showConflictResolution,ec=en.showVersionHistory,el=en.isLoading,eu=en.isLoadingRecord,ed=en.isLoadingHistory,ef=en.error,eh=en.originalVersion,ep=en.setShowConflictResolution,ex=en.setShowVersionHistory,ev=en.setConflictingRecord,eg=en.checkForConflicts,ey=en.loadHistory,em=en.router,eb=en.setIsLoading,ew=en.setError,eR=(A=(q={recordId:et.id,originalVersion:eh,setIsLoading:eb,setError:ew,checkForConflicts:eg,router:em}).recordId,M=q.originalVersion,P=q.setIsLoading,Q=q.setError,G=q.checkForConflicts,J=q.router,K=(0,n.Z)(o().mark(function e(r){var t,n,s;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,P(!0),Q(null),e.next=5,G();case 5:if(!e.sent){e.next=9;break}return P(!1),e.abrupt("return");case 9:return e.next=11,g.c.updateRecordWithVersion(A,r,M);case 11:if(!(t=e.sent).success){e.next=16;break}J.push("/data"),e.next=22;break;case 16:if((null===(n=t.error)||void 0===n?void 0:n.code)!=="CONFLICT"){e.next=21;break}return e.next=19,G();case 19:e.next=22;break;case 21:Q((null===(s=t.error)||void 0===s?void 0:s.message)||"Error al actualizar el registro");case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),Q("Error de conexi\xf3n al actualizar el registro"),e.t0 instanceof Error&&Q("Error de conexi\xf3n: ".concat(e.t0.message));case 28:return e.prev=28,P(!1),e.finish(28);case 31:case"end":return e.stop()}},e,null,[[0,24,28,31]])})),U=function(e){return K.apply(this,arguments)},X=(0,n.Z)(o().mark(function e(r,t,n,s){var a,i,c;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,P(!0),Q(null),e.t0=r,e.next="current"===e.t0?6:"incoming"===e.t0?8:"merge"===e.t0?10:12;break;case 6:return a=t,e.abrupt("break",12);case 8:return a=n,e.abrupt("break",12);case 10:return a=s,e.abrupt("break",12);case 12:return e.next=14,g.c.updateRecord(A,a);case 14:(i=e.sent).success?J.push("/data"):Q((null===(c=i.error)||void 0===c?void 0:c.message)||"Error al resolver el conflicto"),e.next=22;break;case 18:e.prev=18,e.t1=e.catch(0),Q("Error de conexi\xf3n al resolver el conflicto"),e.t1 instanceof Error&&Q("Error de conexi\xf3n: ".concat(e.t1.message));case 22:return e.prev=22,P(!1),e.finish(22);case 25:case"end":return e.stop()}},e,null,[[0,18,22,25]])})),{handleSave:U,handleConflictResolve:function(e,r,t,n){return X.apply(this,arguments)},handleRestoreVersion:($=(0,n.Z)(o().mark(function e(r){var t,n;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,P(!0),Q(null),e.next=5,g.c.updateRecord(A,{type:r.type,data:r.data,metadata:r.metadata});case 5:(t=e.sent).success?J.push("/data"):Q((null===(n=t.error)||void 0===n?void 0:n.message)||"Error al restaurar la versi\xf3n"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),Q("Error de conexi\xf3n al restaurar la versi\xf3n"),e.t0 instanceof Error&&Q("Error de conexi\xf3n: ".concat(e.t0.message));case 13:return e.prev=13,P(!1),e.finish(13);case 16:case"end":return e.stop()}},e,null,[[0,9,13,16]])})),function(e){return $.apply(this,arguments)}),handleCancel:function(){J.push("/data")}}),eC=eR.handleSave,ek=eR.handleConflictResolve,ej=eR.handleRestoreVersion,eE=eR.handleCancel,eH=(ee=(0,n.Z)(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!ec&&0===ea.length)){e.next=3;break}return e.next=3,ey();case 3:ex(!0);case 4:case"end":return e.stop()}},e)})),function(){return ee.apply(this,arguments)}),eS=(er=(0,n.Z)(o().mark(function e(r,t){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ek(r,es,eo,t);case 2:ep(!1);case 3:case"end":return e.stop()}},e)})),function(e,r){return er.apply(this,arguments)});return(0,h.jsx)(p,{record:es,conflictingRecord:eo,history:ea,showConflictResolution:ei,showVersionHistory:ec,isLoading:el,isLoadingRecord:eu,isLoadingHistory:ed,error:ef,onSave:eC,onCancel:eE,onConflictResolve:eS,onConflictCancel:function(){ep(!1),ev(null)},onRestoreVersion:ej,onShowHistory:eH,onCloseHistory:function(){return ex(!1)}})}},17099:function(e,r,t){"use strict";t.d(r,{b:function(){return o}});var n=t(19245),s=t(57437);function o(e){var r,t=e.record,o=e.onShowHistory,a=e.isLoadingHistory;return(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Editar Registro"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:"Modifique la informaci\xf3n del registro de datos"}),t&&(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["ID: ",t.id," | Tipo: ",t.type," | Versi\xf3n:"," ",(null===(r=t.metadata)||void 0===r?void 0:r.version)||1]})]}),(0,s.jsx)("div",{className:"flex space-x-2",children:(0,s.jsx)(n.z,{variant:"outline",onClick:o,disabled:a,children:"Ver Historial"})})]})}},83740:function(e,r,t){"use strict";t.d(r,{B:function(){return c}});var n=t(36118),s=t(19245),o=t(29368),a=t(32090),i=t(57437);function c(e){var r=e.history,t=e.showHistory,c=e.isLoadingHistory,l=e.onToggleHistory;return(0,i.jsxs)(n.Zb,{children:[(0,i.jsx)(n.Ol,{children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)(n.ll,{children:"Historial"}),(0,i.jsxs)(s.z,{variant:"outline",size:"sm",onClick:l,isLoading:c,children:[t?"Ocultar":"Ver"," Historial"]})]})}),t&&(0,i.jsx)(n.aY,{children:r.length>0?(0,i.jsx)("div",{className:"space-y-3",children:r.map(function(e,r){var t;return(0,i.jsxs)("div",{className:"border-l-2 border-blue-200 pl-4",children:[(0,i.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["Versi\xf3n ",(null===(t=e.metadata)||void 0===t?void 0:t.version)||r+1]}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:function(e){try{return(0,o.Q)(new Date(e),{addSuffix:!0,locale:a.es})}catch(r){return e}}(e.updatedAt)}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["por ",e.updatedBy]})]},r)})}):(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"No hay historial disponible"})})]})}}},function(e){e.O(0,[816,873,544,138,930,971,529,744],function(){return e(e.s=69114)}),_N_E=e.O()}]);