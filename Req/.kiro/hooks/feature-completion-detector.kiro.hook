{
  "enabled": true,
  "name": "Feature Completion Detector",
  "description": "Detecta automÃ¡ticamente cuando una feature estÃ¡ completa y ejecuta el proceso de merge",
  "version": "1.0",
  "when": {
    "type": "fileEdited",
    "patterns": [
      "**/tasks.md",
      "**/README.md",
      "**/*feature*.md"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "ğŸ” **Detectando estado de features...**\n\nVoy a revisar si alguna feature estÃ¡ lista para ser completada y mergeada.\n\n## ğŸ“‹ **Verificaciones automÃ¡ticas:**\n\n### 1. **Estado de tareas**\n```bash\n# Revisar archivos de tareas\nfind . -name \"*tasks*.md\" -o -name \"*feature*.md\" | xargs grep -l \"\\[x\\]\"\n```\n\n### 2. **Estado de la rama actual**\n```bash\nCURRENT_BRANCH=$(git branch --show-current)\necho \"ğŸ“ Rama actual: $CURRENT_BRANCH\"\n\n# Si es una feature branch\nif [[ $CURRENT_BRANCH == feature/* ]]; then\n    echo \"ğŸ¯ Feature branch detectada: $CURRENT_BRANCH\"\n    \n    # Verificar commits pendientes\n    UNCOMMITTED=$(git status --porcelain | wc -l)\n    echo \"ğŸ“ Archivos sin commit: $UNCOMMITTED\"\n    \n    # Verificar si estÃ¡ sincronizada con dev\n    git fetch origin dev\n    BEHIND=$(git rev-list --count HEAD..origin/dev)\n    echo \"â¬‡ï¸ Commits detrÃ¡s de dev: $BEHIND\"\nfi\n```\n\n### 3. **AnÃ¡lisis de completitud**\n\n#### **Para features en progreso:**\n- [ ] Â¿Todas las subtareas estÃ¡n marcadas como completadas?\n- [ ] Â¿Los tests estÃ¡n pasando?\n- [ ] Â¿El cÃ³digo estÃ¡ linted y formateado?\n- [ ] Â¿No hay TODOs o FIXMEs crÃ­ticos?\n- [ ] Â¿La documentaciÃ³n estÃ¡ actualizada?\n\n#### **Si la feature estÃ¡ completa:**\n\n## ğŸš€ **Proceso de Completion AutomÃ¡tico**\n\n### **Paso 1: Pre-merge Validations**\n```bash\necho \"ğŸ” Ejecutando validaciones pre-merge...\"\n\n# Tests completos\ncd Req/backend && npm run test\ncd ../frontend && npm run test\n\n# Lint y build\ncd Req/backend && npm run lint && npm run build\ncd ../frontend && npm run lint && npm run build\n\necho \"âœ… Validaciones completadas\"\n```\n\n### **Paso 2: Sync con Dev**\n```bash\necho \"ğŸ”„ Sincronizando con dev...\"\ngit checkout dev\ngit pull origin dev\ngit checkout $CURRENT_BRANCH\ngit merge dev\n\n# Resolver conflictos si existen\nif [ $? -ne 0 ]; then\n    echo \"âš ï¸ Conflictos detectados - resoluciÃ³n manual requerida\"\n    exit 1\nfi\n```\n\n### **Paso 3: Crear PR AutomÃ¡tico**\n```bash\necho \"ğŸ“ Creando Pull Request...\"\n\n# Push final\ngit push origin $CURRENT_BRANCH\n\n# Crear PR con template completo\nFEATURE_NAME=$(echo $CURRENT_BRANCH | sed 's/feature\\///')\n\ngh pr create \\\n  --base dev \\\n  --head $CURRENT_BRANCH \\\n  --title \"feat: $FEATURE_NAME\" \\\n  --body \"## ğŸ¯ Feature Completed: $FEATURE_NAME\n\n### âœ… Completitud Checklist\n- [x] Todas las subtareas completadas\n- [x] Tests unitarios pasando\n- [x] Tests de integraciÃ³n pasando\n- [x] Lint y format OK\n- [x] Build exitoso\n- [x] DocumentaciÃ³n actualizada\n- [x] Sin conflictos con dev\n\n### ğŸ“Š MÃ©tricas\n- Commits: $(git rev-list --count dev..$CURRENT_BRANCH)\n- Archivos modificados: $(git diff --name-only dev | wc -l)\n- LÃ­neas agregadas: $(git diff --stat dev | tail -1)\n\n### ğŸ” Code Review\n- [ ] LÃ³gica de negocio revisada\n- [ ] Seguridad validada\n- [ ] Performance aceptable\n- [ ] UX/UI aprobado\n\n**ğŸ¤– PR creado automÃ¡ticamente por Feature Completion Detector**\"\n\necho \"âœ… PR creado exitosamente\"\n```\n\n### **Paso 4: Post-PR Actions**\n```bash\necho \"ğŸ“‹ Acciones post-PR:\"\necho \"1. âœ… PR creado y listo para review\"\necho \"2. ğŸ”” Notificaciones enviadas a reviewers\"\necho \"3. ğŸ“Š MÃ©tricas de feature registradas\"\necho \"4. â³ Esperando aprobaciÃ³n para auto-merge\"\n```\n\n## ğŸ¯ **DetecciÃ³n Inteligente**\n\n### **Criterios para auto-completion:**\n1. **Rama feature/** activa\n2. **90%+ de tareas completadas** en archivos de tracking\n3. **Tests pasando** en CI/CD\n4. **No hay TODOs crÃ­ticos** en el cÃ³digo\n5. **DocumentaciÃ³n actualizada**\n\n### **Acciones automÃ¡ticas:**\n- âœ… Validaciones pre-merge\n- âœ… Sync con dev\n- âœ… CreaciÃ³n de PR\n- âœ… Notificaciones a team\n- âœ… MÃ©tricas y reporting\n\n## ğŸ“Š **Status Report**\n\nBasado en el archivo modificado, voy a:\n\n1. **Analizar el estado actual** de las features\n2. **Detectar features completadas** o cerca de completarse\n3. **Ejecutar acciones automÃ¡ticas** si corresponde\n4. **Generar reporte** de progreso\n\nÂ¿Procedo con el anÃ¡lisis automÃ¡tico de completitud de features?"
  }
}
