{
  "enabled": true,
  "name": "Deployment Pipeline",
  "description": "Pipeline completo de deployment con validaciones de seguridad antes de producciÃ³n",
  "version": "1.0",
  "when": {
    "type": "manual",
    "buttonText": "ğŸš€ Deploy to Production"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Ejecuta el pipeline completo de deployment a producciÃ³n con todas las validaciones de seguridad.\n\n## âš ï¸ CRÃTICO: Validaciones Pre-Deployment\n\n### 1. **Verificaciones de Rama y Estado**\n```bash\n# Verificar rama actual\nCURRENT_BRANCH=$(git branch --show-current)\nif [ \"$CURRENT_BRANCH\" != \"main\" ]; then\n    echo \"âŒ ERROR: Deployment solo desde rama main\"\n    exit 1\nfi\n\n# Verificar que no hay cambios sin commit\nif [ -n \"$(git status --porcelain)\" ]; then\n    echo \"âŒ ERROR: Hay cambios sin commit\"\n    exit 1\nfi\n```\n\n### 2. **Tests Completos y Build**\n```bash\n# Backend - Tests y Build\ncd Req/backend\nnpm ci\nnpm run lint\nnpm run test -- --coverage\nnpm run build\n\n# Frontend - Tests y Build\ncd ../frontend\nnpm ci\nnpm run lint\nnpm run test\nnpm run build\n```\n\n### 3. **Validaciones de Seguridad**\n- Verificar que no hay secrets hardcodeados\n- Validar configuraciÃ³n de variables de entorno\n- Revisar dependencias con vulnerabilidades\n- Verificar configuraciÃ³n de CORS y headers de seguridad\n\n### 4. **Database Safety Check**\n```bash\n# Verificar migraciones\ncd Req/backend\nnpm run db:generate\n# NO ejecutar db:migrate automÃ¡ticamente en producciÃ³n\necho \"âš ï¸ MANUAL: Revisar migraciones antes de aplicar\"\n```\n\n### 5. **Pre-deployment Checklist**\n- [ ] âœ… Todos los tests pasan\n- [ ] âœ… Build exitoso sin warnings\n- [ ] âœ… No hay vulnerabilidades crÃ­ticas\n- [ ] âœ… Variables de entorno configuradas\n- [ ] âœ… Database migrations revisadas\n- [ ] âœ… Rollback plan preparado\n- [ ] âœ… Monitoring configurado\n\n### 6. **Deployment Steps**\n```bash\n# 1. Backup de base de datos\necho \"ğŸ“¦ Creando backup de base de datos...\"\n\n# 2. Deploy de backend\necho \"ğŸ”§ Deploying backend...\"\n\n# 3. Deploy de frontend\necho \"ğŸ¨ Deploying frontend...\"\n\n# 4. Health checks\necho \"ğŸ” Running health checks...\"\n```\n\n### 7. **Post-deployment Verification**\n- Health check endpoints\n- Verificar funcionalidades crÃ­ticas\n- Monitorear logs por errores\n- Verificar mÃ©tricas de performance\n\n### 8. **Rollback Strategy**\n```bash\n# En caso de problemas crÃ­ticos\necho \"âš ï¸ ROLLBACK DISPONIBLE:\"\necho \"git revert HEAD --no-edit\"\necho \"git push origin main\"\n```\n\n## ğŸš¨ **IMPORTANTE:**\n- **NO deployar si hay tests fallando**\n- **NO deployar si hay vulnerabilidades crÃ­ticas**\n- **SIEMPRE tener plan de rollback listo**\n- **Monitorear activamente post-deployment**\n\nPor favor ejecuta este pipeline paso a paso y reporta cualquier issue encontrado. **DETENER si alguna validaciÃ³n falla.**"
  }
}
