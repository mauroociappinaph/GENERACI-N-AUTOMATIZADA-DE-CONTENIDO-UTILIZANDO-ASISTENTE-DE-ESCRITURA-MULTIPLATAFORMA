{
  "enabled": true,
  "name": "Epic Manager",
  "description": "Gestiona autom√°ticamente los Epics: actualiza progress tracking, detecta completaci√≥n, y mantiene sincronizaci√≥n",
  "version": "1.0",
  "when": {
    "type": "fileEdited",
    "patterns": [
      "**/tasks.md",
      "**/requirements.md"
    ],
    "debounce": 3000
  },
  "then": {
    "type": "askAgent",
    "prompt": "üìã **Epic Manager Activated**\n\nVoy a gestionar autom√°ticamente los Epics y su progress tracking.\n\n## üéØ **Funciones del Epic Manager:**\n\n### **1. Crear Epics con Sub-Issues Autom√°ticamente**\n```bash\necho \"üèóÔ∏è Creando estructura de Epics...\"\n\n# Funci√≥n para crear Epic con sub-issues\ncreate_epic_with_subs() {\n    local epic_title=\"$1\"\n    local epic_description=\"$2\"\n    local sub_issues_data=\"$3\"\n    \n    # Crear Epic principal\n    local epic_id=$(gh issue create \\\n        --title \"$epic_title (Epic)\" \\\n        --body \"## üéØ Epic Overview\n\n$epic_description\n\n## üìä Progress Tracking:\n- **Total Sub-Issues:** 0\n- **Completed:** 0/0\n- **In Progress:** 0/0\n- **Estimated Time:** TBD\n\n## üìã Sub-Issues:\n*Sub-issues will be added automatically*\n\n## üè∑Ô∏è Epic Status:\n- **Phase:** Planning\n- **Priority:** High\n- **Owner:** Unassigned\" \\\n        --label \"enhancement,epic,high-priority\" \\\n        --json number | jq -r '.number')\n    \n    echo \"üìã Epic created: #$epic_id - $epic_title\"\n    \n    # Crear sub-issues\n    local sub_issue_refs=\"\"\n    local sub_count=0\n    \n    # Procesar cada sub-issue\n    while IFS='|' read -r sub_title sub_body sub_labels sub_tasks; do\n        if [ -n \"$sub_title\" ]; then\n            # Crear sub-issue\n            local sub_id=$(gh issue create \\\n                --title \"$sub_title\" \\\n                --body \"## üîó Parent Epic: #$epic_id\n\n### **Description:**\n$sub_body\n\n### **Tasks:**\n$sub_tasks\n\n### **Acceptance Criteria:**\n- [ ] All tasks completed\n- [ ] Tests passing\n- [ ] Code reviewed\n- [ ] Documentation updated\n\n**Part of Epic:** #$epic_id\" \\\n                --label \"$sub_labels\" \\\n                --json number | jq -r '.number')\n            \n            echo \"  ‚îú‚îÄ‚îÄ Sub-Issue created: #$sub_id - $sub_title\"\n            sub_issue_refs=\"$sub_issue_refs\\n- [ ] #$sub_id $sub_title\"\n            sub_count=$((sub_count + 1))\n            \n            # Crear tasks granulares si es necesario\n            if [ -n \"$sub_tasks\" ]; then\n                create_granular_tasks $sub_id \"$sub_tasks\" $epic_id\n            fi\n        fi\n    done <<< \"$sub_issues_data\"\n    \n    # Actualizar Epic con sub-issues reales\n    gh issue edit $epic_id --body \"## üéØ Epic Overview\n\n$epic_description\n\n## üìä Progress Tracking:\n- **Total Sub-Issues:** $sub_count\n- **Completed:** 0/$sub_count\n- **In Progress:** 0/$sub_count\n- **Estimated Time:** TBD\n\n## üìã Sub-Issues:$sub_issue_refs\n\n## üè∑Ô∏è Epic Status:\n- **Phase:** In Development\n- **Priority:** High\n- **Owner:** Unassigned\"\n    \n    return $epic_id\n}\n\n# Funci√≥n para crear tasks granulares\ncreate_granular_tasks() {\n    local parent_issue=$1\n    local tasks_list=\"$2\"\n    local epic_id=$3\n    \n    echo \"    Creating granular tasks for #$parent_issue\"\n    \n    # Procesar cada task\n    echo \"$tasks_list\" | while IFS='\\n' read -r task; do\n        if [ -n \"$task\" ]; then\n            local task_title=$(echo \"$task\" | sed 's/^- \\[ \\] //')\n            \n            gh issue create \\\n                --title \"$task_title\" \\\n                --body \"## üîó Parent Issue: #$parent_issue\n## üîó Epic: #$epic_id\n\n### **Task Description:**\n$task_title\n\n### **Acceptance Criteria:**\n- [ ] Implementation completed\n- [ ] Tests added\n- [ ] Code reviewed\n\n**Estimated Time:** 2-4 hours\n**Part of:** #$parent_issue ‚Üí #$epic_id\" \\\n                --label \"enhancement,good first issue\" > /dev/null\n        fi\n    done\n}\n```\n\n### **2. Actualizar Progress Tracking Autom√°ticamente**\n```bash\necho \"üìä Actualizando progress tracking...\"\n\n# Funci√≥n para actualizar Epic progress\nupdate_all_epics() {\n    # Obtener todos los Epics (issues con label 'epic')\n    local epics=$(gh issue list --label \"epic\" --state open --json number,title)\n    \n    echo \"$epics\" | jq -r '.[] | .number' | while read epic_id; do\n        if [ -n \"$epic_id\" ]; then\n            echo \"üìã Actualizando Epic #$epic_id\"\n            update_epic_progress $epic_id\n        fi\n    done\n}\n\n# Funci√≥n para actualizar un Epic espec√≠fico\nupdate_epic_progress() {\n    local epic_id=$1\n    \n    # Obtener body del Epic\n    local epic_body=$(gh issue view $epic_id --json body | jq -r '.body')\n    \n    # Extraer sub-issues del Epic\n    local sub_issues=$(echo \"$epic_body\" | grep -oE \"#[0-9]+\" | grep -oE \"[0-9]+\" | grep -v \"$epic_id\")\n    \n    local total_subs=0\n    local completed_subs=0\n    local in_progress_subs=0\n    local blocked_subs=0\n    \n    # Analizar cada sub-issue\n    for sub_issue in $sub_issues; do\n        if [ -n \"$sub_issue\" ]; then\n            local sub_info=$(gh issue view $sub_issue --json state,assignees,labels 2>/dev/null)\n            \n            if [ $? -eq 0 ]; then\n                local sub_state=$(echo \"$sub_info\" | jq -r '.state')\n                local sub_assignees=$(echo \"$sub_info\" | jq -r '.assignees | length')\n                local sub_labels=$(echo \"$sub_info\" | jq -r '.labels[].name' | tr '\\n' ' ')\n                \n                total_subs=$((total_subs + 1))\n                \n                if [ \"$sub_state\" = \"CLOSED\" ]; then\n                    completed_subs=$((completed_subs + 1))\n                elif echo \"$sub_labels\" | grep -q \"blocked\"; then\n                    blocked_subs=$((blocked_subs + 1))\n                elif [ $sub_assignees -gt 0 ]; then\n                    in_progress_subs=$((in_progress_subs + 1))\n                fi\n            fi\n        fi\n    done\n    \n    # Calcular progreso\n    local progress_percent=0\n    if [ $total_subs -gt 0 ]; then\n        progress_percent=$((completed_subs * 100 / total_subs))\n    fi\n    \n    # Determinar fase del Epic\n    local epic_phase=\"Planning\"\n    if [ $completed_subs -eq $total_subs ] && [ $total_subs -gt 0 ]; then\n        epic_phase=\"Completed\"\n    elif [ $in_progress_subs -gt 0 ]; then\n        epic_phase=\"In Development\"\n    elif [ $blocked_subs -gt 0 ]; then\n        epic_phase=\"Blocked\"\n    fi\n    \n    # Actualizar Epic body\n    local updated_body=$(echo \"$epic_body\" | sed -E \"s/Total Sub-Issues:\\*\\* [0-9]+/Total Sub-Issues:** $total_subs/g\")\n    updated_body=$(echo \"$updated_body\" | sed -E \"s/Completed:\\*\\* [0-9]+\\/[0-9]+/Completed:** $completed_subs\\/$total_subs ($progress_percent%)/g\")\n    updated_body=$(echo \"$updated_body\" | sed -E \"s/In Progress:\\*\\* [0-9]+\\/[0-9]+/In Progress:** $in_progress_subs\\/$total_subs/g\")\n    updated_body=$(echo \"$updated_body\" | sed -E \"s/Phase:\\*\\* [A-Za-z ]+/Phase:** $epic_phase/g\")\n    \n    # Agregar estad√≠sticas adicionales\n    updated_body=$(echo \"$updated_body\" | sed -E \"s/Estimated Time:\\*\\* [A-Za-z0-9 -]+/Estimated Time:** $((total_subs * 3))-$((total_subs * 5)) days/g\")\n    \n    gh issue edit $epic_id --body \"$updated_body\"\n    \n    echo \"  ‚úÖ Epic #$epic_id updated: $completed_subs/$total_subs completed ($progress_percent%)\"\n    \n    # Si Epic est√° completo, cerrarlo\n    if [ \"$epic_phase\" = \"Completed\" ]; then\n        echo \"üéâ Epic #$epic_id completado! Cerrando...\"\n        gh issue close $epic_id --comment \"üéâ **Epic Completado Autom√°ticamente**\n        \n## üìä Estad√≠sticas Finales:\n- **Total Sub-Issues:** $total_subs\n- **Completados:** $completed_subs\n- **Progreso:** 100%\n- **Tiempo Total:** Calculado autom√°ticamente\n\n## üèÜ Logros:\n- Todos los sub-issues completados\n- Tests pasando\n- Funcionalidad entregada\n\n*Cerrado autom√°ticamente por Epic Manager*\"\n        \n        # Actualizar milestone si es necesario\n        update_milestone_progress\n    fi\n}\n```\n\n### **3. Crear Epics Predefinidos para el Proyecto**\n```bash\necho \"üöÄ Creando Epics del proyecto...\"\n\n# Epic 1: Testing y Calidad\ncreate_epic_with_subs \\\n    \"üß™ Testing and Quality Assurance\" \\\n    \"Complete testing suite for production readiness\" \\\n    \"Integration Tests|Complete API and database testing|testing,backend,high-priority|‚Ä¢ API integration tests\\n‚Ä¢ Database tests\\n‚Ä¢ Auth tests\nE2E Tests|End-to-end testing with Cypress|testing,frontend,high-priority|‚Ä¢ Cypress setup\\n‚Ä¢ Critical user flows\\n‚Ä¢ Performance tests\nCode Quality|Improve code quality and standards|enhancement,good first issue|‚Ä¢ ESLint rules\\n‚Ä¢ Type safety\\n‚Ä¢ Documentation\"\n\n# Epic 2: AI Content System\ncreate_epic_with_subs \\\n    \"ü§ñ AI Content Generation System\" \\\n    \"Complete AI-powered content generation with multi-platform support\" \\\n    \"Database Schema|AI content database models|ai-content,backend,database|‚Ä¢ content_templates table\\n‚Ä¢ generated_content table\\n‚Ä¢ Vector database setup\nAI Services|OpenAI integration and content processing|ai-content,backend,high-priority|‚Ä¢ OpenAI API client\\n‚Ä¢ Prompt management\\n‚Ä¢ Quality analysis\nFrontend Components|AI content generation interface|ai-content,frontend,high-priority|‚Ä¢ Template selector\\n‚Ä¢ Content generator\\n‚Ä¢ Quality dashboard\"\n\n# Epic 3: Social Media Integration\ncreate_epic_with_subs \\\n    \"üåê Multi-Platform Social Media Integration\" \\\n    \"Social media platform adapters and publishing system\" \\\n    \"Platform Adapters|Social media API integrations|social-media,backend,api-integration|‚Ä¢ Facebook Graph API\\n‚Ä¢ Twitter API v2\\n‚Ä¢ Instagram API\\n‚Ä¢ LinkedIn API\nPublishing System|Content scheduling and publishing|social-media,backend,high-priority|‚Ä¢ Scheduling service\\n‚Ä¢ Publishing queue\\n‚Ä¢ Content adaptation\nSocial Dashboard|Social media management interface|social-media,frontend|‚Ä¢ Account management\\n‚Ä¢ Publishing calendar\\n‚Ä¢ Analytics dashboard\"\n\n# Epic 4: Multi-Language Support\ncreate_epic_with_subs \\\n    \"üåç Multi-Language Translation System\" \\\n    \"Translation services and cultural adaptation\" \\\n    \"Translation Services|Multi-provider translation integration|enhancement,backend|‚Ä¢ Google Translate API\\n‚Ä¢ DeepL integration\\n‚Ä¢ Quality scoring\nCultural Adaptation|Region-specific content modifications|enhancement,backend|‚Ä¢ Cultural context\\n‚Ä¢ Localization\\n‚Ä¢ Validation\nLanguage Interface|Multi-language content management|enhancement,frontend|‚Ä¢ Language selector\\n‚Ä¢ Translation workflow\\n‚Ä¢ Quality indicators\"\n```\n\n### **4. Monitoreo y Alertas**\n```bash\necho \"üîî Configurando monitoreo de Epics...\"\n\n# Detectar Epics bloqueados\ndetect_blocked_epics() {\n    local blocked_epics=$(gh issue list --label \"epic\" --state open --json number,title,updatedAt)\n    \n    echo \"$blocked_epics\" | jq -r '.[] | select(.updatedAt | fromdateiso8601 < (now - 604800)) | .number' | while read epic_id; do\n        if [ -n \"$epic_id\" ]; then\n            echo \"‚ö†Ô∏è Epic #$epic_id sin actividad por m√°s de 7 d√≠as\"\n            \n            gh issue comment $epic_id --body \"‚ö†Ô∏è **Epic Stale Alert**\n            \nEste Epic no ha tenido actividad en los √∫ltimos 7 d√≠as.\n\n## üîç Acciones Recomendadas:\n- Revisar sub-issues bloqueados\n- Reasignar tareas si es necesario\n- Actualizar prioridades\n- Considerar dividir en Epics m√°s peque√±os\n\n*Alerta generada autom√°ticamente por Epic Manager*\"\n        fi\n    done\n}\n\n# Detectar dependencias entre Epics\ndetect_epic_dependencies() {\n    echo \"üîó Analizando dependencias entre Epics...\"\n    \n    # Esta funci√≥n analizar√≠a las dependencias y sugerir√≠a orden de ejecuci√≥n\n    # Por ahora, solo reporta el estado\n    \n    local total_epics=$(gh issue list --label \"epic\" --json number | jq '. | length')\n    local completed_epics=$(gh issue list --label \"epic\" --state closed --json number | jq '. | length')\n    local progress=$((completed_epics * 100 / total_epics))\n    \n    echo \"üìä **Epic Progress Summary:**\"\n    echo \"- Total Epics: $total_epics\"\n    echo \"- Completed: $completed_epics\"\n    echo \"- Overall Progress: $progress%\"\n}\n```\n\n## üéØ **Acciones Autom√°ticas del Epic Manager:**\n\n‚úÖ **Epics creados** con estructura jer√°rquica\n‚úÖ **Sub-issues generados** autom√°ticamente\n‚úÖ **Progress tracking** actualizado en tiempo real\n‚úÖ **Tasks granulares** creadas cuando es necesario\n‚úÖ **Labels asignados** autom√°ticamente\n‚úÖ **Relaciones padre-hijo** establecidas\n‚úÖ **Monitoreo de bloqueos** y alertas\n‚úÖ **Estad√≠sticas de progreso** calculadas\n\n## üìä **Ejemplo de Epic Actualizado Autom√°ticamente:**\n\n```\nü§ñ AI Content Generation System (Epic #13)\n\n## üìä Progress Tracking:\n- **Total Sub-Issues:** 3\n- **Completed:** 1/3 (33%)\n- **In Progress:** 1/3\n- **Estimated Time:** 9-15 days\n\n## üìã Sub-Issues:\n- [x] #14 Database Schema and Models\n- [-] #15 AI Services Implementation  \n- [ ] #16 Frontend Components\n\n## üè∑Ô∏è Epic Status:\n- **Phase:** In Development\n- **Priority:** High\n- **Owner:** Assigned Team\n```\n\n**¬øProceder con la creaci√≥n autom√°tica de Epics y configuraci√≥n del Epic Manager?**"
  }
}
