{
  "enabled": true,
  "name": "Production Readiness Validator",
  "description": "Valida que TODO esté funcionando antes de permitir PR a main (producción)",
  "version": "1.0",
  "when": {
    "type": "manual",
    "buttonText": "🔒 Validate for Production"
  },
  "then": {
    "type": "askAgent",
    "prompt": "🔒 **VALIDACIÓN CRÍTICA PARA PRODUCCIÓN**\n\nAntes de crear PR a main, debo verificar que TODO esté funcionando correctamente.\n\n## ⚠️ **VALIDACIONES OBLIGATORIAS:**\n\n### 1. **Tests Completos**\n```bash\necho \"🧪 Ejecutando tests completos...\"\n\n# Backend Tests\ncd Req/backend\nnpm run test -- --coverage --verbose\nif [ $? -ne 0 ]; then\n    echo \"❌ FALLO: Tests de backend fallando\"\n    exit 1\nfi\n\n# Frontend Tests\ncd ../frontend\nnpm run test -- --watchAll=false\nif [ $? -ne 0 ]; then\n    echo \"❌ FALLO: Tests de frontend fallando\"\n    exit 1\nfi\n\necho \"✅ Todos los tests pasan\"\n```\n\n### 2. **Build Completo**\n```bash\necho \"🏗️ Verificando builds...\"\n\n# Backend Build\ncd Req/backend\nnpm run build\nif [ $? -ne 0 ]; then\n    echo \"❌ FALLO: Build de backend falla\"\n    exit 1\nfi\n\n# Frontend Build\ncd ../frontend\nnpm run build\nif [ $? -ne 0 ]; then\n    echo \"❌ FALLO: Build de frontend falla\"\n    exit 1\nfi\n\necho \"✅ Builds exitosos\"\n```\n\n### 3. **Calidad de Código**\n```bash\necho \"🔍 Verificando calidad de código...\"\n\n# Backend Lint\ncd Req/backend\nnpm run lint\nif [ $? -ne 0 ]; then\n    echo \"❌ FALLO: Lint de backend falla\"\n    exit 1\nfi\n\n# Frontend Lint\ncd ../frontend\nnpm run lint\nif [ $? -ne 0 ]; then\n    echo \"❌ FALLO: Lint de frontend falla\"\n    exit 1\nfi\n\necho \"✅ Calidad de código OK\"\n```\n\n### 4. **Seguridad**\n```bash\necho \"🔒 Verificando seguridad...\"\n\n# Audit de dependencias\ncd Req/backend\nnpm audit --audit-level=high\nif [ $? -ne 0 ]; then\n    echo \"⚠️ ADVERTENCIA: Vulnerabilidades encontradas en backend\"\nfi\n\ncd ../frontend\nnpm audit --audit-level=high\nif [ $? -ne 0 ]; then\n    echo \"⚠️ ADVERTENCIA: Vulnerabilidades encontradas en frontend\"\nfi\n\necho \"✅ Audit de seguridad completado\"\n```\n\n### 5. **Base de Datos**\n```bash\necho \"🗄️ Verificando base de datos...\"\n\ncd Req/backend\n# Verificar que Prisma está actualizado\nnpm run db:generate\nif [ $? -ne 0 ]; then\n    echo \"❌ FALLO: Error generando cliente Prisma\"\n    exit 1\nfi\n\n# Test de conexión\nnpm run db:test\nif [ $? -ne 0 ]; then\n    echo \"❌ FALLO: No se puede conectar a la base de datos\"\n    exit 1\nfi\n\necho \"✅ Base de datos OK\"\n```\n\n### 6. **Variables de Entorno**\n```bash\necho \"⚙️ Verificando configuración...\"\n\n# Verificar archivos .env\nif [ ! -f \"Req/backend/.env\" ]; then\n    echo \"❌ FALLO: Falta archivo .env en backend\"\n    exit 1\nfi\n\nif [ ! -f \"Req/frontend/.env.local\" ]; then\n    echo \"⚠️ ADVERTENCIA: Falta archivo .env.local en frontend\"\nfi\n\necho \"✅ Configuración verificada\"\n```\n\n## 📋 **CHECKLIST DE PRODUCCIÓN:**\n\n### **Funcionalidad:**\n- [ ] ✅ Todos los tests unitarios pasan\n- [ ] ✅ Tests de integración pasan\n- [ ] ✅ Build de backend exitoso\n- [ ] ✅ Build de frontend exitoso\n- [ ] ✅ No hay errores de lint\n- [ ] ✅ No hay errores de TypeScript\n\n### **Seguridad:**\n- [ ] ✅ No hay vulnerabilidades críticas\n- [ ] ✅ No hay secrets hardcodeados\n- [ ] ✅ Variables de entorno configuradas\n- [ ] ✅ Headers de seguridad implementados\n\n### **Base de Datos:**\n- [ ] ✅ Conexión a BD funciona\n- [ ] ✅ Migraciones aplicadas\n- [ ] ✅ Cliente Prisma generado\n- [ ] ✅ Backup plan preparado\n\n### **Infraestructura:**\n- [ ] ✅ Configuración de producción lista\n- [ ] ✅ Monitoring configurado\n- [ ] ✅ Logs configurados\n- [ ] ✅ Plan de rollback preparado\n\n## 🚨 **CRITERIOS DE APROBACIÓN:**\n\n### **DEBE PASAR (Obligatorio):**\n- ✅ **Todos los tests pasan**\n- ✅ **Build exitoso sin errores**\n- ✅ **No hay errores de lint**\n- ✅ **Base de datos funciona**\n\n### **DEBE REVISAR (Crítico):**\n- ⚠️ **Vulnerabilidades de seguridad**\n- ⚠️ **Performance issues**\n- ⚠️ **Breaking changes**\n\n## 🎯 **RESULTADO:**\n\nDespués de ejecutar todas las validaciones, te daré uno de estos resultados:\n\n### ✅ **APROBADO PARA PRODUCCIÓN**\n```\n🎉 ¡Listo para producción!\n- Todos los tests pasan\n- Build exitoso\n- Calidad de código OK\n- Seguridad validada\n- Base de datos OK\n\n✅ PUEDES CREAR PR A MAIN\n```\n\n### ❌ **NO APROBADO - REQUIERE CORRECCIONES**\n```\n🚨 NO listo para producción\n- [Lista de issues encontrados]\n- [Acciones requeridas]\n\n❌ NO CREAR PR A MAIN HASTA CORREGIR\n```\n\n### ⚠️ **APROBADO CON ADVERTENCIAS**\n```\n⚠️ Listo con precauciones\n- [Lista de advertencias]\n- [Recomendaciones]\n\n⚠️ PUEDES CREAR PR PERO MONITOREA ACTIVAMENTE\n```\n\n## 🚀 **¿Ejecutar validación completa?**\n\nEsto tomará unos minutos pero es CRÍTICO para asegurar que producción no se rompa.\n\n**¿Proceder con la validación completa para producción?**"
  }
}
